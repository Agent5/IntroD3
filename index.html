<!DOCTYPE html>
<html>
  <head>
    <title>D3 Intro</title>
    <link rel="stylesheet" type="text/css" href="deck.css">
    <script src="lib/d3.min.js"></script>
    <script src="slide_maker.js"></script>
    <script>
      var title;

      function empty_svg(parent) {
        window.svg = d3.select(parent).append('svg');
      }

      function rect1(parent) {
        empty_svg(parent);

        svg
          .append('rect')
          .attr('x', 150)
          .attr('y', 100)
          .attr('width', 60)
          .attr('height', 300);
      }

      function rect3(parent) {
        empty_svg(parent);

        svg.append('rect')
          .attr('x', 200)
          .attr('y', 300)
          .attr('width', 40)
          .attr('height', 50);

        svg.append('rect')
          .attr('x', 100)
          .attr('y', 20)
          .attr('width', 30)
          .attr('height', 50);

        svg.append('rect')
          .attr('x', 10)
          .attr('y', 200)
          .attr('width', 25)
          .attr('height', 90);
      }
    </script>
  </head>
  <body>

    <section class="main_title">
      <h1>D3</h1>
      <h2>Data Driven Documents</h2>
      <div class="name">Vadim Ogievetsky</div>
      <div class="date">Feb 16, 2012</div>
    </section>

    <script>
    // -------------------------------------------------
    slide.code_title(title = '.select()');

    slide.code(title, rect1, function() {
      // svg = d3.select('svg.that_svg_to_the_right')
      var myRect = svg.select('rect')
      myRect.attr('width', 100)
      myRect.attr('height', 100)
      myRect.style('fill', 'steelblue')
    });

    slide.code(title, rect1, function() {
      // svg = d3.select('svg.that_svg_to_the_right')
      svg.select('rect')
        .attr('width', 100)
        .attr('height', 100)
        .style('fill', 'steelblue')
    });


    // -------------------------------------------------
    slide.code_title(title = '.selectAll()');

    slide.code(title, rect3, function() {
      svg.select('rect')
        .attr('width', 100)
        .attr('height', 100)
        .style('fill', 'steelblue')
    });

    slide.code(title, rect3, function() {
      svg.selectAll('rect')
        .attr('width', 100)
        .attr('height', 100)
        .style('fill', 'steelblue')
    });

    slide.code(title, rect3, function() {
      svg.selectAll('rect')
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return i * 150 + 100; })
        .attr('height', 20)
        .style('fill', 'steelblue')
    });


    // -------------------------------------------------
    slide.code_title(title = '.data()');

    slide.code(title, rect3, function() {
      svg.selectAll('rect')
        .data([64, 128, 256])
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')
    });

    // -------------------------------------------------
    slide.code_title(title = '.enter()');

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128, 256, 71])

      selection
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')
    });

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128, 256, 71])

      selection
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')

      selection.enter().append('rect')
        .attr('x', 10) // let's just put it somewhere
        .attr('y', 10)
        .attr('width', 30)
        .attr('height', 30)
        .style('fill', 'green')
    });

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128, 256, 71])

      selection
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')

      selection.enter().append('rect')
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue') // this doesn't look out of place
    });

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128, 256, 71])

      // Shorter
      selection.enter().append('rect')

      // when updating the regular selection then enter selection
      // is joined in to the update selection
      selection
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')
    });

    slide.code(title + ' // a common pattern', empty_svg, function() {
      svg.selectAll('rect')
        .data([64, 128, 256])
        .enter().append('rect')
          .attr('x', 0)
          .attr('y', function(d,i) { return i*100+50; })
          .attr('width', function(d,i) { return d; })
          .attr('height', 20)
          .style('fill', 'steelblue')
    });


    // -------------------------------------------------
    slide.code_title(title = '.exit()');

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128])

      selection
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')
    });

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128])

      selection
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')

      selection.exit()
        .remove()
    });


    // -------------------------------------------------
    slide.code_title(title = '.transition()');

    slide.code(title, rect3, function() {
      svg.selectAll('rect')
        .data([64, 128, 256])
        .transition()
        .duration(3000) // 3 seconds
          .attr('x', 0)
          .attr('y', function(d,i) { return i*100+50; })
          .attr('width', function(d,i) { return d; })
          .attr('height', 20)
          .style('fill', 'steelblue')
    });

    slide.code(title, rect3, function() {
      var selection = svg.selectAll('rect')
        .data([64, 128, 256, 71])

      selection.enter().append('rect')
        .attr('x', 200)
        .attr('y', 200)
        .attr('width', 10)
        .attr('height', 10)
        .style('fill', 'red')

      selection
        .transition()
        .duration(3000)
          .attr('x', 0)
          .attr('y', function(d,i) { return i*100+50; })
          .attr('width', function(d,i) { return d; })
          .attr('height', 20)
          .style('fill', 'steelblue')
          .transition()
          .duration(3000)
          .delay(3000)
            .attr('width', function(d,i) { return d*1.5; })
            .style('fill', 'green')

      selection.exit()
        .attr('opacity', 1)
        .transition()
        .duration(3000)
          .attr('opacity', 0)
          .remove();
    });

    // -------------------------------------------------
    slide.code_title(title = '.data(..., join)');

    function init_svg(parent) {
      empty_svg(parent);
      svg.selectAll('rect')
        .data([64, 128, 256])
        .enter().append('rect')
          .attr('x', 0)
          .attr('y', function(d,i) { return i*100+50; })
          .attr('width', function(d,i) { return d; })
          .attr('height', 20)
          .style('fill', 'steelblue')
    }

    slide.code(title, init_svg, function() {
      // Let's say we start here:

      // svg.selectAll('rect')
      //   .data([64, 128, 256])
      //   .enter().append('rect')
      //     .attr('x', 0)
      //     .attr('y', function(d,i) { return i*100+50; })
      //     .attr('width', function(d,i) { return d; })
      //     .attr('height', 20)
      //     .style('fill', 'steelblue')

      // And then we do this:

      var selection = svg.selectAll('rect')
        .data([128, 256, 71]) // <- incomplete?

      selection.enter().append('rect')
        .attr('x', 0)
        .attr('y', function(d,i) { return i*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')

      selection
        .transition()
        .duration(3000)
          .attr('x', 0)
          .attr('y', function(d,i) { return i*100+50; })
          .attr('width', function(d,i) { return d; })
          .attr('height', 20)
          .style('fill', 'steelblue')

      selection.exit()
        .remove()

      // Note that String(5) === "5"
    });

    slide.code(title, init_svg, function() {
      // Let's say we start here:

      // svg.selectAll('rect')
      //   .data([64, 128, 256])
      //   .enter().append('rect')
      //     .attr('x', 0)
      //     .attr('y', function(d,i) { return i*100+50; })
      //     .attr('width', function(d,i) { return d; })
      //     .attr('height', 20)
      //     .style('fill', 'steelblue')

      // And then we do this:

      var selection = svg.selectAll('rect')
        .data([128, 256, 71], String)

      selection.enter().append('rect')
        .attr('x', 0)
        .attr('y', function(d,i) { return (i+1)*100+50; })
        .attr('width', function(d,i) { return d; })
        .attr('height', 20)
        .style('fill', 'steelblue')
        .style('opacity', 0)


      selection
        .transition()
        .duration(3000)
          .attr('y', function(d,i) { return i*100+50; })
          .attr('height', 20)
          .style('opacity', 1)

      selection.exit()
        .transition()
        .duration(3000)
          .attr('y', function(d,i) { return (i-1)*100+50; })
          .style('opacity', 0)
          .remove()
    });

    slide.code('d3', empty_svg, function() {
      // fill me
    });

    // A more complex example

    /*
    ToDo:
    - add MMX logo
    - add the link to GH
    */

    </script>

    <section class="image2">
      <h1>Where to learn more about SVG?</h1>
      Fill me with SVG book slide and inspect screeenshot
    </section>

    <section class="title">
      <h1>Questions?</h1>
    </section>

  </body>
  <script type="text/javascript" src="deck.js"></script>
</html>